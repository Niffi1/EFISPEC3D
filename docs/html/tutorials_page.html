<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript">        
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36176948-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="html_extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logoEfispec2.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="http://efispec.free.fr"><span>EFISPEC&#160;Website</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorials_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ex1_sec">Layer over half-space model</a><ul><li class="level2"><a href="#ex1_prefix_ssec">Creating prefix file</a></li>
<li class="level2"><a href="#ex1_mesh_ssec">Creating mesh file</a></li>
<li class="level2"><a href="#ex1_config_ssec">Creating configuration file</a></li>
<li class="level2"><a href="#ex1_source_ssec">Creating source file</a></li>
<li class="level2"><a href="#ex1_receiver_ssec">Creating receiver file</a></li>
<li class="level2"><a href="#ex1_launching_efi">Launching EFISPEC3D</a></li>
<li class="level2"><a href="#ex1_plot_rec_ssec">Plotting Gnuplot files</a></li>
<li class="level2"><a href="#ex1_visu_vtk_ssec">Visualizing VTK files</a></li>
</ul>
</li>
<li class="level1"><a href="#ex2_sec">Model including topography</a><ul><li class="level2"><a href="#exc2_efi_tools">Compiling EFISPEC3D tools</a></li>
<li class="level2"><a href="#ex2_mesh_ssec">Creating mesh file</a></li>
<li class="level2"><a href="#ex2_config_ssec">Creating configuration file</a></li>
<li class="level2"><a href="#ex2_source_ssec">Creating source file</a></li>
<li class="level2"><a href="#ex2_launching_efi">Launching EFISPEC3D</a></li>
<li class="level2"><a href="#ex2_visu_vtk_ssec">Visualizing VTK files</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ex1_sec"></a>
Layer over half-space model</h1>
<p>This section presents how to prepare and run a simulation using the SCEC model named Layer Over Half-space 1 (LOH.1). See website <a href="http://www.seismowine.org/" target="_blank">SEISMOWINE</a> for more information.</p>
<dl class="section note"><dt>Note</dt><dd>Input files are in the directory EFISPEC3D/docs/tutorials/t01/ </dd>
<dd>
Once the input files are prepared, go to <a class="el" href="launch_efi_page.html">Launching Simulations</a> to see how to launch the simulation.</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="getstarted_page.html">Getting Started</a> to read how to prepare input files.</dd></dl>
<h2><a class="anchor" id="ex1_prefix_ssec"></a>
Creating prefix file</h2>
<p>In your simulation directory, create the file "prefix" which contains the prefix of input files </p>
<pre class="fragment">echo "t01" &gt; prefix
</pre><h2><a class="anchor" id="ex1_mesh_ssec"></a>
Creating mesh file</h2>
<p>The mesh is designed to be accurate up to 1 Hz (using Lagrange polynomial of order 4 (<a class="el" href="classmod__global__variables.html#ac33a8c9973e2e0c70a9f5add6b81dde1" title="order of Lagrange&#39;s polynomials. Should be set from 4 to 6. ">mod_global_variables::ig_lagrange_order</a>) and approximately 7 Gauss-Logatto-Legendre nodes at 1 Hz).</p>
<p>Run the journal file <a href="../tutorials/t01/t01.jou">t01.jou</a> </p>
<pre class="fragment">path_to_cubit_bash_script/cubit -nogui -nojournal t01.jou
</pre><p> This should create the file t01.inp that contains the mesh of the simulation. To visualise a specific block (such as the absorbing boundary), execute CUBIT command line </p>
<pre class="fragment">draw block 3
</pre><h2><a class="anchor" id="ex1_config_ssec"></a>
Creating configuration file</h2>
<p>The configuration file <a href="../tutorials/t01/t01.cfg">t01.cfg</a> (see below) sets up the general parameters of the simulation:</p>
<ul>
<li>The total duration is set to \(20\) s subdivided into \( \Delta t = 3.0e^{-3} \) s to satisfy the Courant–Friedrichs–Lewy condition (CFL condition).</li>
<li>The receivers time histories are saved every \(10 \Delta t = 3.0e^{-2}\) s.</li>
<li>The snapshots showing the velocity of particles motion are saved every \(50 \Delta t = 0.15\) s. The receivers used for the snapshots are spaced every \(250\) m.</li>
<li>The absorbing boundaries are activated. Quadrangle elements used as absorbing boundaries are those defined by CUBIT block named fsu (see <a href="../tutorials/t01/t01.jou">CUBIT journal file</a>)</li>
<li>The medium is defined by two materials whose elastic properties are the shear-wave velocity (vs), the pressure-wave velocity (vp) and the density (rho). The material 1 defines the elastic properties of hexahedron elements grouped inside CUBIT block 1 and so on (see <a href="../tutorials/t01/t01.jou">CUBIT journal file</a>).</li>
</ul>
<pre class="fragment">!*******************************************
!time information
!*******************************************
duration of simulation         = 20.0
time step                      = 3.0e-3

!*******************************************
!receivers' output
!*******************************************
receiver saving increment      = 10

!*******************************************
!snapshot output
!*******************************************
snapshot saving  increment     = 50
snapshot space   increment     = 250.0
snapshot displacement          = .false.
snapshot velocity              = .true.
snapshot acceleration          = .false.

!*******************************************
!boundary absorption information
!*******************************************
boundary absorption            = .true.

!*******************************************
!medium information
!*******************************************
number of material             = 2

material                       = 1
vs                             = 2000.0
vp                             = 4000.0
rho                            = 2600.0

material                       = 2
vs                             = 3464.0
vp                             = 6000.0
rho                            = 2700.0</pre><h2><a class="anchor" id="ex1_source_ssec"></a>
Creating source file</h2>
<p>The SCEC model LOH.1 includes one double couple point source at 2000 meters depth. The file <a href="../tutorials/t01/t01.dcs">t01.dcs</a> is as follows </p>
<pre class="fragment">    1
  0.0     0.0   -2000.0    5.999     0.0     90.0      0.0     6.0      3.0      8
</pre><dl class="section note"><dt>Note</dt><dd>The source function is a hyperbolic tangent instead of a step exponential as defined by the SCEC model LOH.1</dd></dl>
<h2><a class="anchor" id="ex1_receiver_ssec"></a>
Creating receiver file</h2>
<p>The receivers (located on the free surface) are defined by their \(x,y\)-coordinates in the file <a href="../tutorials/t01/t01.fsr">t01.fsr</a> </p>
<pre class="fragment">  693.0     0.0
  5543.0    0.0
  10392.0   0.0
  490.0     490.0
  3919.0    3919.0
  7348.0    7348.0
  384.0     577.0
  3075.0    4612.0
  5764.0    8647.0
</pre><h2><a class="anchor" id="ex1_launching_efi"></a>
Launching EFISPEC3D</h2>
<p>In your simulation directory, execute the command line </p>
<pre class="fragment">mpiexec.hydra -n ncore path_to_EFISPEC3D_binary/efispec3d_1.0sse.exe
</pre><p>The simulation should run for about 15 min on 2 cores (simulation performed on a laptop with Intel(R) Core(TM) i5-3320M). Increase the number of cores to decrease the computational time.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="launch_efi_page.html">Launching Simulations</a></dd></dl>
<h2><a class="anchor" id="ex1_plot_rec_ssec"></a>
Plotting Gnuplot files</h2>
<p>To plot receivers files *.fsr.*.gpl (or *.vor.*.gpl) created by EFISPEC3D, execute in a gnuplot terminal (at least version 4.4) </p>
<pre class="fragment">a=2
plot "loh3.fsr.000001.gpl" binary format="%10f" u 1:a with line
</pre><ul>
<li>a = 2,3,4 corresponds to \(x,y,z\)-displacements, respectively</li>
<li>a = 5,6,7 corresponds to \(x,y,z\)-velocities , respectively</li>
<li>a = 8,9,10 corresponds to \(x,y,z\)-accelerations, respectively</li>
</ul>
<dl class="section see"><dt>See Also</dt><dd>subroutines <a class="el" href="classmod__receiver.html#aae632c5a1ba4949bb544c569eb5b4c49" title="This subroutine reads all receivers in file *.fsr; determines to which cpu they belong; computes thei...">mod_receiver::init_quad_receiver</a> and <a class="el" href="classmod__receiver.html#a0d5c6c0d3784008057a9741aec3c43fe" title="This subroutine writes -displacements, velocities and accelerations at receivers. ...">mod_receiver::write_receiver_output</a>.</dd></dl>
<h2><a class="anchor" id="ex1_visu_vtk_ssec"></a>
Visualizing VTK files</h2>
<p>To vizualize snapshots files *.vts, open the file "t01.collection.snapshot.vxyz.pvd" in Paraview. To visualize peak ground displacement, velocity or acceleration, open the files t01.snapshot.PG*xyz.vts in ParaView.</p>
<h1><a class="anchor" id="ex2_sec"></a>
Model including topography</h1>
<p>This tutorial explains how to deform a flat mesh generated by CUBIT with a Digital Elevation Model (DEM).</p>
<dl class="section note"><dt>Note</dt><dd>Input files are in the directory EFISPEC3D/docs/tutorials/t02/ </dd>
<dd>
Once the input files are prepared, go to <a class="el" href="launch_efi_page.html">Launching Simulations</a> to see how to launch the simulation. </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="getstarted_page.html">Getting Started</a> to read how to prepare input files.</dd></dl>
<h2><a class="anchor" id="exc2_efi_tools"></a>
Compiling EFISPEC3D tools</h2>
<p>In EFISPEC3D directory, execute the command line </p>
<pre class="fragment">make efispec_tools
</pre><p> This should create the executable EFISPEC3D/bin/cubit_topography.exe</p>
<h2><a class="anchor" id="ex2_mesh_ssec"></a>
Creating mesh file</h2>
<ol type="1">
<li>Create the mesh with a flat free surface by running the journal file <a href="../tutorials/t02/t02.jou">t02.jou</a> <pre class="fragment">path_to_cubit_bash_script/cubit -nogui -nojournal t02.jou
</pre> This should create the file "t02.inp" that contains the mesh with a flat free surface.</li>
<li>Deform the mesh with cubit_topography.exe (this program linearly transforms geometric nodes of the file "t02.inp" located between given zmax and zmin according to t02.dem) <pre class="fragment">path_to_cubit_topography.exe/cubit_topography.exe t02.inp t02.dem 0.0 -1000.0
</pre> This should create the files "t02_topo.jou" and "t02_tmp.inp". The file t02_tmp.inp contains the mesh deformed according to the DEM. However, no absorbing boundary and free surface are defined. To do so, move to step 3 below.</li>
<li>Run the CUBIT journal file t02_topo.jou (the journal file imports "t02_tmp.inp" and applies boundary conditions needed by EFISPEC3D. <pre class="fragment">path_to_cubit_bash_script/cubit -nogui -nojournal t02_topo.jou
</pre> This should create the file "t02_topo.inp" which contains the mesh deformed according to the DEM and the absorbing/free surface boundary conditions. The file "t02_tmp.inp" can be deleted.</li>
<li>Replace the file "t02.inp" by "t02_topo.inp" <pre class="fragment">mv t02_topo.inp t02.inp
</pre></li>
</ol>
<dl class="section note"><dt>Note</dt><dd>.dem file shall have an <a href="http://resources.esri.com/help/9.3/arcgisengine/java/GP_ToolRef/spatial_analyst_tools/esri_ascii_raster_format.htm" target="_blank">ESRI ASCII Raster format</a>.</dd></dl>
<h2><a class="anchor" id="ex2_config_ssec"></a>
Creating configuration file</h2>
<p>The configuration file <a href="../tutorials/t02/t02.cfg">t02.cfg</a> (see below) sets up the general parameters of the simulation.</p>
<pre class="fragment">!*******************************************
!time information
!*******************************************
duration of simulation         = 20.0
time step                      = 0.5e-3

!*******************************************
!receivers' output
!*******************************************
receiver saving increment      = 20

!*******************************************
!snapshot output
!*******************************************
snapshot saving  increment     = 200
snapshot space   increment     = 100.0
snapshot displacement          = .false.
snapshot velocity              = .true.
snapshot acceleration          = .false.

!*******************************************
!boundary absorption information
!*******************************************
boundary absorption            = .true.

!*******************************************
!medium information
!*******************************************
number of material             = 1

material                       = 1
vs                             = 2000.0
vp                             = 4000.0
rho                            = 2600.0</pre><h2><a class="anchor" id="ex2_source_ssec"></a>
Creating source file</h2>
<p>A double couple point source with a strike of \(15^{\circ}\), a dip of \(70^{\circ}\) and a rake of \(10^{\circ}\) is placed in the middle of the model at 2000 meters depth. The file <a href="../tutorials/t02/t02.dcs">t02.dcs</a> is as follows </p>
<pre class="fragment">    1
  9600.0   8000.0   -2000.0    3.0    15.0     90.0     10.0     4.0      2.0      8
</pre><h2><a class="anchor" id="ex2_launching_efi"></a>
Launching EFISPEC3D</h2>
<p>In your simulation directory, execute the command line </p>
<pre class="fragment">mpiexec.hydra -n ncore path_to_EFISPEC3D_binary/efispec3d_1.0sse.exe
</pre><p>The simulation should run for about 20 min on 128 cores. Increase the number of cores to decrease the computational time.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="launch_efi_page.html">Launching Simulations</a></dd></dl>
<h2><a class="anchor" id="ex2_visu_vtk_ssec"></a>
Visualizing VTK files</h2>
<p>To vizualize snapshots files *.vts, open the file "t02.collection.snapshot.vxyz.pvd" in Paraview. To visualize peak ground displacement, velocity or acceleration, open the files t02.snapshot.PG*xyz.vts in ParaView. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
